<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>EroÄŸlu | TV Servis YÃ¶netimi</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;400;700;900&display=swap" rel="stylesheet">
    
    <style>
        .icon-dashboard::before { content: "ğŸ“Š"; }
        .icon-records::before { content: "ğŸ“‘"; }
        .icon-add::before { content: "â•"; }
        .icon-settings::before { content: "ğŸ› ï¸"; }
        .icon-admin::before { content: "âš™ï¸"; }
        .icon-menu::before { content: "â˜°"; }
    </style>
    
    <style>
        /* MÄ°NÄ°MALÄ°ST KESKÄ°N SÄ°YAH TEMA */
        :root{
            /* VarsayÄ±lan Renkler */
            --primary: #FF5733; /* Vurgu Rengi (Keskin Turuncu/KÄ±rmÄ±zÄ±) */
            --bg: #0A0A0A; /* Ana Arka Plan (Ã‡ok Koyu Siyah) */
            --card: #1C1C1C; /* Kart Arka PlanÄ± (Koyu Gri) */
            --text: #F0F0F0; /* Metin Rengi */
            
            /* TÃ¼retilmiÅŸ Renkler */
            --primary-dark: #CC472A;
            --muted: #888888; /* Gri Metin */
            --border: #333333; /* Hafif SÄ±nÄ±r */
            --shadow: 0 5px 20px rgba(0, 0, 0, 0.8);
            --header-bg: var(--card); 
            --sidebar-bg: var(--card);
            --font-body: 'Poppins', sans-serif; /* Yeni Font */
        }

        /* TEMEL STÄ°LLER */
        *{box-sizing:border-box}
        html,body{height:100%;margin:0;font-family:var(--font-body);color:var(--text);background:var(--bg); transition: background-color 0.3s}
        
        /* SPLASH SCREEN - SADE VE KESKÄ°N LOGO */
        #splash{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:var(--bg);z-index:9999; opacity:1; transition: opacity 0.5s ease-out 2.5s;} 
        .splash-title{
            font-weight:900;
            letter-spacing: 12px;
            font-size:clamp(60px, 14vw, 120px);
            color: var(--primary);
            text-shadow: 0 0 8px var(--primary); /* Neon IÅŸÄ±ltÄ± */
            animation: textReveal 1s ease both; 
        }
        @keyframes textReveal {
            from { opacity: 0; transform: translateY(20px); filter: blur(10px); }
            to { opacity: 1; transform: translateY(0); filter: blur(0); }
        }

        /* HEADER */
        .header{height:60px;display:flex;align-items:center;gap:16px;padding:0 20px;background:var(--header-bg);color:var(--text);position:fixed;top:0;left:0;right:0;z-index:900;border-bottom:1px solid var(--border); box-shadow: var(--shadow)}
        .header .brand{font-weight:900;font-size:1.6rem; color:var(--primary);}
        .header .actions{margin-left:auto;display:flex;gap:10px;align-items:center}
        
        /* SIDEBAR */
        .sidebar{width:240px;background:var(--sidebar-bg);height:calc(100vh - 60px);padding:15px 0;position:fixed;left:0;top:60px;border-right:1px solid var(--border);transition:transform .3s ease;z-index:800; box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5)}
        .sidebar.hidden{transform:translateX(-100%)}
        .side-btn{display:flex;align-items:center;gap:15px;padding:15px 20px;border-radius:0;background:transparent;border:0;color:var(--text);cursor:pointer;width:100%;text-align:left; transition: background-color 0.2s, color 0.2s}
        .side-btn:hover{background:#282828; color:var(--primary)}
        .side-btn.active{background:var(--primary); color:var(--card); font-weight:700;}
        .side-btn.active:hover{background:var(--primary-dark)}

        /* MAIN CONTENT & CARDS */
        .main{margin-left:240px;padding:30px;flex:1;min-height:calc(100vh - 60px); transition: margin-left 0.3s; background: var(--bg)}
        .panel-content .card{margin-bottom:0 !important;}
        .card{background:var(--card);padding:25px;border-radius:2px;border:1px solid var(--border);box-shadow:var(--shadow);margin-bottom:25px;}
        .grid-3{display:grid;grid-template-columns:repeat(auto-fit, minmax(220px, 1fr));gap:20px}
        
        /* Ä°STATÄ°STÄ°K KARTLARI */
        .stat-card{padding:20px; border-radius:2px; background:var(--card); border-left:5px solid var(--primary); box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);}
        .stat-title{font-size:0.9rem; color:var(--muted); margin-bottom:8px; text-transform:uppercase;}
        .stat-value{font-weight:900;font-size:2.5rem; color:var(--primary);}

        /* FORMLAR & BUTONLAR */
        .form-row{display:flex; gap:15px; margin-bottom:15px; align-items:center; flex-wrap:wrap;}
        .input, .select, .textarea{padding:12px 15px;border-radius:2px;border:1px solid var(--border);background:var(--bg);color:var(--text); font-size:1rem; transition: border-color 0.2s; width:100%;}
        .input:focus, .select:focus, .textarea:focus { border-color: var(--primary); outline: none;}
        .textarea { resize: vertical; min-height: 80px;}
        .btn{padding:12px 20px;border-radius:2px;cursor:pointer;background:var(--primary);border:none;color:var(--card); font-weight:600; transition: background-color 0.2s}
        .btn:hover{background:var(--primary-dark)}
        .btn-secondary{background:var(--muted); color:var(--card)}
        .btn-secondary:hover{background:#606060}
        .label{width:150px; color:var(--muted); font-weight:600;}

        /* MODAL */
        .modal{position:fixed;inset:0;background:rgba(0,0,0,.8); backdrop-filter: blur(4px);display:flex;align-items:center;justify-content:center;z-index:1000; opacity:0; pointer-events:none; transition: opacity 0.3s}
        .modal.visible{opacity:1; pointer-events:auto}
        .modal-box{width:90%;max-width:400px;background:var(--card);padding:30px;border-radius:2px; border:1px solid var(--primary);}

        /* TABLO */
        .table{width:100%;border-collapse:collapse; margin-top:15px}
        .table th,.table td{padding:15px;border-bottom:1px solid var(--border);text-align:left;}
        .table th{background:var(--bg); color:var(--primary); font-weight:700}
        .table tbody tr:hover{background:rgba(255, 87, 51, 0.05)} /* Vurgu rengine gÃ¶re hafif hover */

        /* UTILS */
        .hidden-panel{display:none}
        .muted{color:var(--muted)}
        .badge{display:inline-block;padding:4px 10px;border-radius:2px;font-size:0.8rem; font-weight:600}
        .badge.active{background:#28a745; color:#fff}
        .badge.passive{background:#dc3545; color:#fff}

        /* RESPONSIVE */
        @media (max-width: 900px){
            .sidebar{width:100%; height:calc(100vh - 60px); top:60px;}
            .main{margin-left:0;padding:15px}
            .hamburger{display:flex; align-items:center; justify-content:center; font-size:1.2rem; color:var(--primary)}
            .sidebar.hidden{transform:translateX(-100%)}
        }
    </style>
</head>
<body>

<div id="splash"><div class="splash-title">EROÄLU</div></div>

<header class="header">
    <button class="hamburger" id="hambBtn" aria-label="menÃ¼"><span class="icon-menu"></span></button>
    <div class="brand">EROÄLU SERVÄ°S</div>
    <div class="actions">
        <button id="adminSettingsBtn" class="btn hidden" style="padding:8px 15px; font-size:0.9rem;">
            <span class="icon-admin"></span> Admin AyarlarÄ±
        </button>
    </div>
</header>

<nav id="sidebar" class="sidebar hidden">
    <button class="side-btn active" data-panel="dashboard"><span class="icon-dashboard"></span> Servis Ã–zeti</button>
    <button class="side-btn" data-panel="records"><span class="icon-records"></span> Servis KayÄ±tlarÄ±</button>
    <button class="side-btn" data-panel="add"><span class="icon-add"></span> Yeni Servis GiriÅŸi</button>
    <button class="side-btn" data-panel="settings"><span class="icon-settings"></span> Ayarlar</button>
</nav>

<main class="main">
    <section id="dashboard" class="panel-content">
        <div class="card">
            <h2 style="color:var(--primary); border-bottom:1px solid var(--border); padding-bottom:10px;">ğŸ“Š Servis Ã–zeti</h2>
            <div class="grid-3" style="margin-top:20px">
                <div class="stat-card">
                    <div class="stat-title">TOPLAM SERVÄ°S KAYDI</div>
                    <div class="stat-value" id="statRecords">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">GARANTÄ°SÄ° SÃœREN Ä°ÅLEM</div>
                    <div class="stat-value" id="statActiveWarranty">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">BU AY EKLENEN Ä°ÅLEM</div>
                    <div class="stat-value" id="statThisMonth">0</div>
                </div>
            </div>
            <div class="card" style="margin-top:25px">
                <h3 style="margin-top:0; color:var(--primary)">HaftalÄ±k Ä°ÅŸlem GrafiÄŸi</h3>
                <canvas id="visitorsChart" height="100"></canvas>
            </div>
        </div>
    </section>

    <section id="records" class="panel-content hidden-panel">
        <div class="card">
            <h2 style="color:var(--primary); border-bottom:1px solid var(--border); padding-bottom:10px;">ğŸ“‘ Servis KayÄ±tlarÄ± Listesi</h2>
            <div style="overflow-x:auto;margin-top:20px">
                <table class="table" id="recordsTable">
                    <thead>
                        <tr>
                            <th>TV Kod/Seri</th>
                            <th>Model</th>
                            <th>YapÄ±lan Ä°ÅŸlem</th>
                            <th>KayÄ±t Tarihi</th>
                            <th>Garanti BitiÅŸ</th>
                            <th>Ä°ÅŸlem</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </section>

    <section id="add" class="panel-content hidden-panel">
        <div class="card">
            <h2 style="color:var(--primary); border-bottom:1px solid var(--border); padding-bottom:10px;">â• Yeni Servis GiriÅŸi</h2>
            <div style="margin-top:20px;">
                <div class="form-row">
                    <label class="label">TV Kod/Seri No:</label>
                    <input id="inpCode" class="input" placeholder="MÃ¼ÅŸteri Kodu veya TV Seri No" type="text" style="flex:1" />
                </div>
                <div class="form-row">
                    <label class="label">TV Modeli:</label>
                    <input id="inpModel" class="input" placeholder="Ã–rn: Samsung QLED 55" type="text" style="flex:1" />
                </div>
                <div class="form-row">
                    <label class="label">YapÄ±lan Ä°ÅŸlem:</label>
                    <select id="inpProcess" class="select" style="flex:1">
                        <option value="Led DeÄŸiÅŸim">Led DeÄŸiÅŸim</option>
                        <option value="Panel DeÄŸiÅŸim">Panel DeÄŸiÅŸim</option>
                        <option value="Mainboard OnarÄ±m">Mainboard OnarÄ±m</option>
                        <option value="DiÄŸer">DiÄŸer (AÃ§Ä±klamaya YazÄ±lacak)</option>
                    </select>
                </div>
                
                <h3 style="color:var(--muted); margin-top:30px; border-bottom:1px solid var(--border); padding-bottom:5px;">Ek Detaylar & Garanti</h3>
                
                <div class="form-row">
                    <label class="label">Ä°ÅŸlem DetaylarÄ± (El ile):</label>
                    <textarea id="inpNotes" class="textarea" placeholder="Ekstra Notlar, MÃ¼ÅŸteri Bilgisi vb." style="flex:1"></textarea>
                </div>
                
                <div class="form-row">
                    <label class="label">Garanti BitiÅŸ Tarihi (Manuel):</label>
                    <input id="inpWarrantyDate" class="input" type="date" style="flex:1" />
                </div>
                <p class="muted" style="font-size:0.9rem; margin-top:-10px;">*(Manuel tarih girilmezse, kayÄ±t tarihi Ã¼zerine **1 yÄ±l otomatik garanti** eklenir.)</p>

                <div style="display:flex;gap:10px;margin-top:20px">
                    <button class="btn" id="addRecordBtn" style="flex:1">KaydÄ± Sisteme Ekle</button>
                    <button class="btn btn-secondary" id="clearBtn" style="flex:1">Formu Temizle</button>
                </div>
            </div>
        </div>
    </section>

    <section id="settings" class="panel-content hidden-panel">
        <div class="card">
            <h2 style="color:var(--primary); border-bottom:1px solid var(--border); padding-bottom:10px;">ğŸ› ï¸ Sistem AyarlarÄ±</h2>
            <div style="margin-top:20px">
                <p class="muted">Veri YÃ¶netimi:</p>
                <button id="exportBtn" class="btn" style="margin-top:10px">Verileri DÄ±ÅŸa Aktar (JSON)</button>
            </div>
            <hr style="border:none; border-top:1px dashed var(--border); margin:20px 0"/>
            <p class="muted">Admin Panelini YapÄ±landÄ±rma:</p>
            <button id="openAdminPanel" class="btn">Admin Renk AyarlarÄ±na Git</button>
        </div>
    </section>
    
    <section id="admin-panel" class="panel-content hidden-panel">
        <div class="card">
            <h2 style="color:#FFD700; border-bottom:1px solid var(--border); padding-bottom:10px;">âš™ï¸ Admin AyarlarÄ± & Renk Paleti</h2>
            
            <h3 style="color:var(--primary); margin-top:20px;">Tema Renklerini Ayarla (HEX Kod)</h3>
            
            <div class="form-settings">
                <div class="form-row">
                    <div class="label">Vurgu Rengi (--primary)</div>
                    <input id="color-primary" class="input" type="color" value="#FF5733" style="width:60px; height:40px; padding:0; border:none;"/>
                    <input id="color-primary-hex" class="input" type="text" placeholder="#HEX" style="flex:1; max-width:120px;"/>
                </div>
                
                <div class="form-row">
                    <div class="label">Arka Plan (--bg)</div>
                    <input id="color-bg" class="input" type="color" value="#0A0A0A" style="width:60px; height:40px; padding:0; border:none;"/>
                    <input id="color-bg-hex" class="input" type="text" placeholder="#HEX" style="flex:1; max-width:120px;"/>
                </div>

                <div class="form-row">
                    <div class="label">Kart Arka PlanÄ± (--card)</div>
                    <input id="color-card" class="input" type="color" value="#1C1C1C" style="width:60px; height:40px; padding:0; border:none;"/>
                    <input id="color-card-hex" class="input" type="text" placeholder="#HEX" style="flex:1; max-width:120px;"/>
                </div>
                
                <div class="form-row">
                    <div class="label">Metin Rengi (--text)</div>
                    <input id="color-text" class="input" type="color" value="#F0F0F0" style="width:60px; height:40px; padding:0; border:none;"/>
                    <input id="color-text-hex" class="input" type="text" placeholder="#HEX" style="flex:1; max-width:120px;"/>
                </div>

                <button id="saveColorsBtn" class="btn" style="width:100%; margin-top:15px;">Renkleri Uygula & Kaydet</button>
            </div>

            <h3 style="color:var(--primary); margin-top:30px;">Admin Åifresini DeÄŸiÅŸtir</h3>
            <div class="form-settings">
                <input id="newAdminCode" class="input" placeholder="Yeni Admin Kodu (Mevcut: ****)" type="password" style="width:100%; margin-bottom:10px;"/>
                <button id="changeAdminCodeBtn" class="btn btn-secondary" style="width:100%;">Admin Kodunu GÃ¼ncelle</button>
            </div>
        </div>
    </section>

</main>

<div id="authModal" class="modal">
    <div class="modal-box">
        <h3 style="margin:0 0 15px; color:var(--primary);">ğŸ”’ Yetkili Kod GiriÅŸi</h3>
        <input id="authCodeInput" class="input" placeholder="Admin Kodunu Girin" type="password" style="width:100%; margin-bottom:10px"/>
        <div style="display:flex;gap:10px;margin-top:10px;justify-content:flex-end">
            <button id="authCancel" class="btn btn-secondary">Ä°ptal</button>
            <button id="authSubmit" class="btn">GiriÅŸ</button>
        </div>
        <p id="authErr" style="color:#dc3545;margin-top:10px;display:none; text-align:right">Hata: Kod hatalÄ±!</p>
    </div>
</div>


<script>
// --- App state & helpers ---
const DEFAULT_COLORS = {primary: '#FF5733', bg: '#0A0A0A', card: '#1C1C1C', text: '#F0F0F0'};
const LOCAL_STORAGE_KEY_COLORS = 'eroglu_colors_v4';
const LOCAL_STORAGE_KEY_ADMIN = 'eroglu_admin_code_v4';
const LOCAL_STORAGE_KEY_RECORDS = 'eroglu_records_v4';

let records = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY_RECORDS)||'[]');
let ADMIN_CODE = localStorage.getItem(LOCAL_STORAGE_KEY_ADMIN) || '6161'; 
let isAdminLoggedIn = false;


// DOM refs
const htmlEl = document.documentElement;
const sidebar = document.getElementById('sidebar');
const hamb = document.getElementById('hambBtn');
const sideBtns = Array.from(document.querySelectorAll('.side-btn[data-panel]'));
const panels = {
    dashboard: document.getElementById('dashboard'), 
    records: document.getElementById('records'), 
    add: document.getElementById('add'), 
    settings: document.getElementById('settings'),
    'admin-panel': document.getElementById('admin-panel')
};
const recordsTableBody = document.querySelector('#recordsTable tbody');
const authModal = document.getElementById('authModal');
const adminSettingsBtn = document.getElementById('adminSettingsBtn');

// Tarih formatlama yardÄ±mcÄ± fonksiyonu
function formatDate(dateString) {
    if (!dateString) return 'N/A';
    const options = { year: 'numeric', month: 'short', day: 'numeric' };
    try {
        return new Date(dateString).toLocaleDateString('tr-TR', options);
    } catch {
        return dateString; // Hata durumunda ham veriyi dÃ¶ndÃ¼r
    }
}

// 1. Renkleri YÃ¶netme (AynÄ± Kod)
function loadColors() {
    let colors = DEFAULT_COLORS;
    try {
        colors = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY_COLORS)) || DEFAULT_COLORS;
    } catch(e) { console.error("Renk yÃ¼kleme hatasÄ±:", e); }
    
    htmlEl.style.setProperty('--primary', colors.primary);
    htmlEl.style.setProperty('--bg', colors.bg);
    htmlEl.style.setProperty('--card', colors.card);
    htmlEl.style.setProperty('--text', colors.text);
    
    // Admin panelindeki renk inputlarÄ±nÄ± doldur
    document.getElementById('color-primary').value = colors.primary;
    document.getElementById('color-bg').value = colors.bg;
    document.getElementById('color-card').value = colors.card;
    document.getElementById('color-text').value = colors.text;
    document.getElementById('color-primary-hex').value = colors.primary;
    document.getElementById('color-bg-hex').value = colors.bg;
    document.getElementById('color-card-hex').value = colors.card;
    document.getElementById('color-text-hex').value = colors.text;
    
    if(window.visitorsChart) renderChart();
}

function saveAndApplyColors() {
    const newColors = {
        primary: document.getElementById('color-primary-hex').value.toUpperCase(),
        bg: document.getElementById('color-bg-hex').value.toUpperCase(),
        card: document.getElementById('color-card-hex').value.toUpperCase(),
        text: document.getElementById('color-text-hex').value.toUpperCase(),
    };
    
    for (const key in newColors) {
        if (!/^#[0-9A-F]{6}$/.test(newColors[key])) {
            alert('Hata: LÃ¼tfen tÃ¼m renkler iÃ§in geÃ§erli 6 haneli HEX kodu girin (Ã¶rn: #AABBCC).');
            return;
        }
    }

    localStorage.setItem(LOCAL_STORAGE_KEY_COLORS, JSON.stringify(newColors));
    loadColors(); 
    alert('Tema renkleri baÅŸarÄ±yla gÃ¼ncellendi ve kaydedildi.');
}

// 2. Yetkili GiriÅŸi YÃ¶netme (AynÄ± Kod)
function showAuthModal() {
    authModal.classList.add('visible');
    document.getElementById('authCodeInput').value = '';
    document.getElementById('authErr').style.display = 'none';
}

function handleAuthSubmit() {
    const enteredCode = document.getElementById('authCodeInput').value.trim();
    if (enteredCode === ADMIN_CODE) {
        isAdminLoggedIn = true;
        authModal.classList.remove('visible');
        adminSettingsBtn.classList.remove('hidden'); 
        showPanel('admin-panel');
        alert('Admin giriÅŸi baÅŸarÄ±lÄ±! ArtÄ±k Renk/Åifre AyarlarÄ±nÄ± kullanabilirsiniz.');
    } else {
        document.getElementById('authErr').style.display = 'block';
    }
}

function changeAdminCode() {
    const newCode = document.getElementById('newAdminCode').value.trim();
    if (newCode && newCode.length >= 4) {
        ADMIN_CODE = newCode;
        localStorage.setItem(LOCAL_STORAGE_KEY_ADMIN, newCode);
        document.getElementById('newAdminCode').value = '';
        alert('Admin ÅŸifresi baÅŸarÄ±yla gÃ¼ncellendi!');
    } else {
        alert('Yeni ÅŸifre en az 4 karakter olmalÄ±dÄ±r.');
    }
}

// 3. Servis KayÄ±tlarÄ±nÄ± YÃ¶netme (GÃ¼ncel Kod)
function renderRecords(){
    recordsTableBody.innerHTML='';
    const today = new Date();
    records.forEach((r,i)=>{
        const warrantyEnd = new Date(r.warrantyDate);
        const isWarrantyActive = warrantyEnd > today;
        const badgeClass = isWarrantyActive ? 'active' : 'passive';
        const badgeText = isWarrantyActive ? 'SÃœRÃœYOR' : 'BÄ°TTÄ°';
        
        const tr=document.createElement('tr');
        tr.innerHTML=`
            <td>${r.code}</td>
            <td>${r.model}</td>
            <td>${r.process}</td>
            <td>${formatDate(r.created)}</td>
            <td><span class="badge ${badgeClass}">${formatDate(r.warrantyDate)} - ${badgeText}</span></td>
            <td>
                <button class="btn" style="padding:6px 10px; font-size:0.8rem;" onclick="viewNotes(${i})">Detay</button> 
                <button class="btn btn-secondary" style="padding:6px 10px; font-size:0.8rem;" onclick="delRecord(${i})">Sil</button>
            </td>
        `;
        recordsTableBody.appendChild(tr);
    });
    updateStats();
}

function updateStats(){
    document.getElementById('statRecords').innerText = records.length;
    
    const today = new Date();
    document.getElementById('statActiveWarranty').innerText = records.filter(r => new Date(r.warrantyDate) > today).length;
    
    const currentMonth = today.getMonth();
    const currentYear = today.getFullYear();
    document.getElementById('statThisMonth').innerText = records.filter(r=>{
        const d = new Date(r.created); 
        return d.getMonth() === currentMonth && d.getFullYear() === currentYear;
    }).length
}

document.getElementById('addRecordBtn').addEventListener('click',()=>{
    const code=document.getElementById('inpCode').value.trim();
    const model=document.getElementById('inpModel').value.trim();
    const process=document.getElementById('inpProcess').value;
    const notes=document.getElementById('inpNotes').value.trim();
    const manualWarrantyDate=document.getElementById('inpWarrantyDate').value;
    
    if(!code||!model||!process){alert('Hata: Kod, Model ve Ä°ÅŸlem alanlarÄ± zorunludur!');return;}
    
    let warrantyDate;
    if (manualWarrantyDate) {
        // Manuel tarih girildi
        const manualDate = new Date(manualWarrantyDate);
        // EÄŸer saat dilimi farkÄ±ndan dolayÄ± bir gÃ¼n kayarsa, dÃ¼zeltme yap (isteÄŸe baÄŸlÄ±)
        manualDate.setMinutes(manualDate.getMinutes() + manualDate.getTimezoneOffset());
        warrantyDate = manualDate.toISOString();
    } else {
        // Otomatik 1 yÄ±l garanti
        const oneYearLater = new Date();
        oneYearLater.setFullYear(oneYearLater.getFullYear() + 1);
        warrantyDate = oneYearLater.toISOString();
    }

    records.push({
        code, 
        model, 
        process, 
        notes,
        created: new Date().toISOString(),
        warrantyDate: warrantyDate 
    });
    
    localStorage.setItem(LOCAL_STORAGE_KEY_RECORDS, JSON.stringify(records));
    
    // Formu temizle
    document.getElementById('inpCode').value='';
    document.getElementById('inpModel').value='';
    document.getElementById('inpProcess').value='Led DeÄŸiÅŸim';
    document.getElementById('inpNotes').value='';
    document.getElementById('inpWarrantyDate').value='';
    
    renderRecords();
    showPanel('records');
    alert('Yeni servis kaydÄ± baÅŸarÄ±yla eklendi!');
});

document.getElementById('clearBtn').addEventListener('click',()=>{
    document.getElementById('inpCode').value='';
    document.getElementById('inpModel').value='';
    document.getElementById('inpProcess').value='Led DeÄŸiÅŸim';
    document.getElementById('inpNotes').value='';
    document.getElementById('inpWarrantyDate').value='';
});

function delRecord(i){
    if(!confirm('Bu servis kaydÄ±nÄ± silmek istediÄŸinizden emin misiniz?')) return;
    records.splice(i,1);
    localStorage.setItem(LOCAL_STORAGE_KEY_RECORDS,JSON.stringify(records));
    renderRecords();
}

function viewNotes(i){
    const record = records[i];
    alert(`--- Ä°ÅŸlem DetaylarÄ± ---\n\nKod/Seri: ${record.code}\nModel: ${record.model}\nÄ°ÅŸlem: ${record.process}\nKayÄ±t Tarihi: ${formatDate(record.created)}\nGaranti BitiÅŸi: ${formatDate(record.warrantyDate)}\n\n--- El ile Notlar ---\n\n${record.notes || 'Not bulunmamaktadÄ±r.'}`);
}

document.getElementById('exportBtn').addEventListener('click',()=>{
    const data='data:application/json;charset=utf-8,'+encodeURIComponent(JSON.stringify(records, null, 2));
    const a=document.createElement('a');
    a.href=data;
    a.download='eroglu_servis_data_export.json';
    a.click();
});

// 4. Grafik YÃ¶netimi (AynÄ± Kod)
let visitorsChart;
function renderChart(){
    const ctx=document.getElementById('visitorsChart').getContext('2d');
    const labels=['Pzt','Sal','Ã‡ar','Per','Cum','Cmt','Paz'];
    // Bu deÄŸerler sadece Ã¶rnek bir grafiktir. GerÃ§ek verilerinize gÃ¶re deÄŸiÅŸtirilebilir.
    const values = [45,60,50,75,65,90,80]; 
    
    const themeColor = getComputedStyle(htmlEl).getPropertyValue('--primary').trim();
    const mutedColor = getComputedStyle(htmlEl).getPropertyValue('--muted').trim();
    const borderColor = getComputedStyle(htmlEl).getPropertyValue('--border').trim();

    if(visitorsChart) visitorsChart.destroy(); 
    
    visitorsChart=new Chart(ctx,{
        type:'line',
        data:{
            labels, 
            datasets:[{
                label:'HaftalÄ±k Servis KaydÄ±',
                data:values,
                fill:true,
                backgroundColor: themeColor + '30', 
                borderColor: themeColor,
                borderWidth: 2,
                pointBackgroundColor: themeColor,
                pointRadius: 5,
                pointHoverRadius: 8,
                tension:0.4 
            }]
        },
        options:{
            responsive:true,
            maintainAspectRatio: false,
            plugins:{legend:{display:false}},
            scales: {
                y: {beginAtZero: true, grid: {color: borderColor}, ticks: {color: mutedColor}},
                x: {grid: {display: false}, ticks: {color: mutedColor}}
            },
            animation:{duration:1000}
        }
    });
}


// --- EVENT LISTENERS & INITIALIZATION ---

window.addEventListener('load',()=>{
    // Splash screen (3 saniye)
    setTimeout(()=>{
        document.getElementById('splash').style.opacity='0';
        setTimeout(()=>document.getElementById('splash').style.display='none', 500); 
    }, 3000); 
    
    loadColors(); 
    renderAll(); 
});

// Sidebar & Panel geÃ§iÅŸleri
hamb.addEventListener('click',()=>{
    sidebar.classList.toggle('hidden');
    if (window.innerWidth < 900) {
        document.body.style.overflow = sidebar.classList.contains('hidden') ? 'auto' : 'hidden';
    }
});

sideBtns.forEach(b=>b.addEventListener('click',(e)=>{
    sideBtns.forEach(btn => btn.classList.remove('active'));
    e.currentTarget.classList.add('active');
    
    showPanel(b.dataset.panel); 
    if(window.innerWidth < 900) {
        sidebar.classList.add('hidden');
        document.body.style.overflow = 'auto';
    }
}));

function showPanel(id){
    Object.values(panels).forEach(p=>p.classList.add('hidden-panel')); 
    panels[id].classList.remove('hidden-panel');
    document.querySelector('.main').scrollTop=0; 
    
    if (id === 'admin-panel') loadColors(); 
}

if(window.innerWidth > 900) sidebar.classList.remove('hidden');

// Admin AyarlarÄ± Yetki AkÄ±ÅŸÄ±
document.getElementById('openAdminPanel').addEventListener('click', () => {
    if (isAdminLoggedIn) {
        showPanel('admin-panel');
    } else {
        showAuthModal();
    }
});
adminSettingsBtn.addEventListener('click', () => {
    if (isAdminLoggedIn) {
        showPanel('admin-panel');
    } else {
         showPanel('settings');
         alert('Admin ayarlarÄ±nÄ± gÃ¶rmek iÃ§in Ã¶ncelikle yetkili kod ile giriÅŸ yapmalÄ±sÄ±nÄ±z.');
    }
});

document.getElementById('authSubmit').addEventListener('click', handleAuthSubmit);
document.getElementById('authCancel').addEventListener('click', () => authModal.classList.remove('visible'));

// Renk InputlarÄ± Senkronizasyonu
document.querySelectorAll('.form-settings input[type="color"]').forEach(input => {
    input.addEventListener('input', (e) => {
        document.getElementById(e.target.id + '-hex').value = e.target.value.toUpperCase();
        htmlEl.style.setProperty('--' + e.target.id.replace('color-', ''), e.target.value);
        if(window.visitorsChart) renderChart();
    });
});

document.querySelectorAll('.form-settings input[type="text"]').forEach(input => {
    input.addEventListener('input', (e) => {
        const hex = e.target.value.toUpperCase();
        if (/^#[0-9A-F]{6}$/i.test(hex)) {
            document.getElementById(e.target.id.replace('-hex', '')).value = hex;
            htmlEl.style.setProperty('--' + e.target.id.replace('color-', '').replace('-hex', ''), hex);
            if(window.visitorsChart) renderChart();
        }
    });
});

document.getElementById('saveColorsBtn').addEventListener('click', saveAndApplyColors);
document.getElementById('changeAdminCodeBtn').addEventListener('click', changeAdminCode);

function renderAll() {
    renderRecords();
    renderChart();
}
</script>
</body>
</html>
