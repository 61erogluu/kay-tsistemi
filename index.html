<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EROÄLU TV Garanti - YÃ¶netim Paneli</title>
<style>
:root{--bg:#0b1220;--card:#0f1724;--muted:#9bb0d1;--text:#eaf2ff;--accent:#3a86ff;--accent-2:#2b6ed6;--glass:rgba(255,255,255,0.03);}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;}
body{background:linear-gradient(180deg,#071226 0%, #07182a 100%);color:var(--text);}
.app{display:flex;height:100vh;align-items:stretch;}
.sidebar{width:300px;background:linear-gradient(180deg,#071028,#0b1830);border-right:1px solid rgba(255,255,255,0.03);padding:28px 18px;display:flex;flex-direction:column;gap:12px}
.brand{font-weight:800;font-size:20px;letter-spacing:1px;margin-bottom:6px}
.sidebar .btn{display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.03);cursor:pointer;color:var(--text)}
.sidebar .btn:hover{background:rgba(255,255,255,0.02)}
.select, input, button, textarea{font-family:inherit}
.content{flex:1;padding:28px;overflow:auto}
.header{display:flex;align-items:center;justify-content:space-between;gap:18px;margin-bottom:18px}
.header .left{display:flex;align-items:center;gap:14px}
.header h1{margin:0;font-size:20px}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);border-radius:12px;padding:18px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px}
.full{grid-column:1/-1}
.form-row{display:flex;gap:12px}
.form-row input, .form-row select{flex:1}
label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
.input, input, select, textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text);outline:none}
.action{background:var(--accent);border:0;color:white;padding:10px 12px;border-radius:8px;cursor:pointer}
.table-wrap{overflow:auto}
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:14px}
th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:left}
th{font-size:13px;color:var(--muted)}
.controls{display:flex;gap:8px;align-items:center}
.kv{display:flex;gap:8px;align-items:center}
.kv strong{display:block}
.footer-stats{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
.stat{background:var(--glass);padding:10px;border-radius:8px;min-width:120px}
.small{font-size:13px;color:var(--muted)}
@media (max-width:1000px){.sidebar{width:72px;padding:18px}.sidebar .label{display:none}.grid{grid-template-columns:1fr}.content{padding:18px}}
</style>
</head>
<body>
<div class="app">
  <aside class="sidebar card" aria-label="Panel">
    <div>
      <div class="brand">EROÄLU â€¢ TV Garanti</div>
      <div class="small">YÃ¶netim Paneli</div>
    </div>
    <button class="btn" data-panel="new">â• Yeni KayÄ±t</button>
    <button class="btn" data-panel="records">ğŸ“‹ KayÄ±tlÄ±lar</button>
    <button class="btn" data-panel="expired">â° Garantisi Bitenler</button>
    <button class="btn" data-panel="stats">ğŸ“Š Ä°statistikler</button>
    <button class="btn" data-panel="monthly">ğŸ—“ï¸ Ä°ÅŸ Tablosu</button>
    <div style="margin-top:auto">
      <div class="small">Tema</div>
      <select id="themeSelect" class="input" aria-label="Tema">
        <option value="dark">Koyu</option>
        <option value="light">AÃ§Ä±k</option>
      </select>
      <div style="height:14px"></div>
      <button id="exportCsv" class="btn">â¬‡ï¸ CSV DÄ±ÅŸa Aktar</button>
      <button id="clearAll" class="btn" style="margin-top:8px">ğŸ§¹ TÃ¼m KayÄ±tlarÄ± Sil</button>
    </div>
  </aside>

  <main class="content">
    <header class="header">
      <div class="left">
        <h1>TV Tamir YÃ¶netimi</h1>
        <div class="small">PC sÃ¼rÃ¼mÃ¼ - GeniÅŸ ekran iÃ§in optimise</div>
      </div>
      <div class="controls">
        <div class="kv"><span class="small">KayÄ±t sayÄ±sÄ±</span><strong id="count">0</strong></div>
        <div class="kv"><span class="small">Toplam TL</span><strong id="sumTL">0</strong></div>
      </div>
    </header>

    <!-- Yeni KayÄ±t -->
    <section id="panel-new" class="card">
      <h2 style="margin-top:0">Yeni KayÄ±t</h2>
      <div class="grid">
        <div>
          <label>Usta</label>
          <select id="usta" class="input">
            <option>Osman Usta</option>
            <option>Mehmet Usta</option>
          </select>
        </div>
        <div>
          <label>SN Kodu</label>
          <input id="sn" class="input" placeholder="Ã–rn: SN123456">
        </div>
        <div>
          <label>Tamir TÃ¼rÃ¼</label>
          <select id="tamir" class="input">
            <option value="YazÄ±lÄ±m">YazÄ±lÄ±m (6 Ay)</option>
            <option value="Besleme">Besleme Tamir (1 YÄ±l)</option>
            <option value="LED">LED DeÄŸiÅŸimi (1 YÄ±l)</option>
            <option value="Panel">Panel DeÄŸiÅŸimi (1 YÄ±l)</option>
            <option value="Anakart">Anakart (1 YÄ±l)</option>
            <option value="Diger">DiÄŸer</option>
          </select>
        </div>
        <div id="otherWrap" style="display:none">
          <label>DiÄŸer Tamir TÃ¼rÃ¼</label>
          <input id="otherTamir" class="input" placeholder="DiÄŸer tamir tÃ¼rÃ¼nÃ¼ yazÄ±nÄ±z">
        </div>

        <div>
          <label>Fiyat (TL)</label>
          <input id="fiyat" type="number" class="input" placeholder="0">
        </div>
        <div>
          <label>Tarih</label>
          <input id="tarih" type="date" class="input">
        </div>

        <div class="full" style="display:flex;gap:10px">
          <button id="saveBtn" class="action">Kaydet</button>
          <button id="updateBtn" class="action" style="display:none;background:var(--accent-2)">GÃ¼ncelle</button>
          <button id="resetBtn" class="btn">Temizle</button>
        </div>
      </div>
    </section>

    <!-- KayÄ±tlÄ±lar -->
    <section id="panel-records" class="card" style="margin-top:14px;display:none">
      <h2>KayÄ±tlÄ±lar</h2>
      <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
        <input id="search" class="input" placeholder="SN ile ara...">
        <select id="filterUsta" class="input"><option value="all">TÃ¼mÃ¼</option><option>Osman Usta</option><option>Mehmet Usta</option></select>
        <select id="filterType" class="input"><option value="all">TÃ¼mÃ¼</option><option>YazÄ±lÄ±m</option><option>Besleme</option><option>LED</option><option>Panel</option><option>Anakart</option></select>
      </div>
      <div class="table-wrap">
        <table id="recordsTable" aria-live="polite">
          <thead><tr><th>SN</th><th>Usta</th><th>Tamir</th><th>Garanti</th><th>Fiyat</th><th>Tarih</th><th>Ä°ÅŸlem</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Garantisi Bitenler -->
    <section id="panel-expired" class="card" style="margin-top:14px;display:none">
      <h2>Garantisi Bitenler</h2>
      <div class="table-wrap">
        <table id="expiredTable"><thead><tr><th>SN</th><th>Usta</th><th>Tamir</th><th>Garanti</th></tr></thead><tbody></tbody></table>
      </div>
    </section>

    <!-- Ä°statistikler -->
    <section id="panel-stats" class="card" style="margin-top:14px;display:none">
      <h2>Ä°statistikler</h2>
      <div class="footer-stats">
        <div class="stat"><div class="small">LED</div><strong id="totalLED">0</strong></div>
        <div class="stat"><div class="small">Besleme</div><strong id="totalBesleme">0</strong></div>
        <div class="stat"><div class="small">Panel</div><strong id="totalPanel">0</strong></div>
        <div class="stat"><div class="small">YazÄ±lÄ±m</div><strong id="totalYazilim">0</strong></div>
        <div class="stat"><div class="small">Anakart</div><strong id="totalAnakart">0</strong></div>
        <div class="stat"><div class="small">Toplam TL</div><strong id="totalTL">0</strong></div>
      </div>
    </section>

    <!-- Ä°ÅŸ Tablosu -->
    <section id="panel-monthly" class="card" style="margin-top:14px;display:none">
      <h2>Ä°ÅŸ Tablosu</h2>
      <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
        <select id="timeFilter" class="input"><option value="all">TÃ¼m KayÄ±tlar</option><option value="weekly">HaftalÄ±k</option><option value="monthly">AylÄ±k</option></select>
      </div>
      <div class="table-wrap">
        <table id="monthlyTable"><thead><tr><th>SN</th><th>Usta</th><th>Tamir</th><th>Tarih</th><th>Fiyat</th></tr></thead><tbody></tbody></table>
      </div>
    </section>

  </main>
</div>

<script>
// Helper: get/set storage with ISO dates
const STORAGE_KEY = 'tvRecords_v2';
let records = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
let editIndex = null;

// UI elements
const panels = {
  new: document.getElementById('panel-new'),
  records: document.getElementById('panel-records'),
  expired: document.getElementById('panel-expired'),
  stats: document.getElementById('panel-stats'),
  monthly: document.getElementById('panel-monthly')
};

document.querySelectorAll('.sidebar .btn').forEach(b=>{
  b.addEventListener('click', ()=>{
    const p = b.getAttribute('data-panel'); showPanel(p);
  })
});

function showPanel(id){
  Object.values(panels).forEach(el=>el.style.display='none');
  panels[id].style.display='block';
}

// Tamir tÃ¼rÃ¼ 'DiÄŸer' kontrol
const tamirEl = document.getElementById('tamir');
const otherWrap = document.getElementById('otherWrap');
const otherEl = document.getElementById('otherTamir');

tamirEl.addEventListener('change', ()=>{
  otherWrap.style.display = tamirEl.value === 'Diger' ? 'block' : 'none';
});

// Save / Update
const saveBtn = document.getElementById('saveBtn');
const updateBtn = document.getElementById('updateBtn');
const resetBtn = document.getElementById('resetBtn');

saveBtn.addEventListener('click', addRecord);
updateBtn.addEventListener('click', updateRecord);
resetBtn.addEventListener('click', clearForm);

function addRecord(){
  const sn = document.getElementById('sn').value.trim();
  const usta = document.getElementById('usta').value;
  let tamir = document.getElementById('tamir').value;
  if(tamir === 'Diger') tamir = otherEl.value.trim() || 'DiÄŸer';
  const fiyat = parseFloat(document.getElementById('fiyat').value) || 0;
  const tarihInput = document.getElementById('tarih').value;
  const tarih = tarihInput ? new Date(tarihInput).toISOString().slice(0,10) : new Date().toISOString().slice(0,10);

  if(!sn || !tamir){ alert('SN ve Tamir tÃ¼rÃ¼ gerekli'); return; }

  records.push({sn,usta,tamir,fiyat,tarih});
  persist();
  renderAll();
  clearForm();
}

function updateRecord(){
  if(editIndex === null) return;
  const sn = document.getElementById('sn').value.trim();
  const usta = document.getElementById('usta').value;
  let tamir = document.getElementById('tamir').value;
  if(tamir === 'Diger') tamir = otherEl.value.trim() || 'DiÄŸer';
  const fiyat = parseFloat(document.getElementById('fiyat').value) || 0;
  const tarihInput = document.getElementById('tarih').value;
  const tarih = tarihInput ? new Date(tarihInput).toISOString().slice(0,10) : new Date().toISOString().slice(0,10);
  records[editIndex] = {sn,usta,tamir,fiyat,tarih};
  persist(); renderAll(); clearForm();
}

function clearForm(){
  document.getElementById('sn').value='';
  document.getElementById('fiyat').value='';
  document.getElementById('otherTamir').value='';
  document.getElementById('tarih').value='';
  document.getElementById('tamir').value='YazÄ±lÄ±m';
  otherWrap.style.display='none';
  editIndex = null; updateBtn.style.display='none'; saveBtn.style.display='inline-block';
}

function persist(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(records)); }

// Rendering
const recordsTbody = document.querySelector('#recordsTable tbody');
const expiredTbody = document.querySelector('#expiredTable tbody');
const monthlyTbody = document.querySelector('#monthlyTable tbody');

function garantiText(tamir, tarihISO){
  const date = new Date(tarihISO + 'T00:00:00');
  let months = 6;
  if(['Besleme','LED','Panel','Anakart'].some(t=>tamir.includes(t))) months = 12;
  const due = new Date(date);
  due.setMonth(due.getMonth() + months);
  return new Date() > due ? 'Bitti' : due.toLocaleDateString('tr-TR');
}

function renderRecords(){
  const filter = document.getElementById('search').value.toLowerCase();
  const filterUsta = document.getElementById('filterUsta').value;
  const filterType = document.getElementById('filterType').value;
  recordsTbody.innerHTML='';
  records.forEach((r,i)=>{
    if(filter && !r.sn.toLowerCase().includes(filter)) return;
    if(filterUsta !== 'all' && r.usta !== filterUsta) return;
    if(filterType !== 'all' && !r.tamir.includes(filterType)) return;
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${r.sn}</td><td>${r.usta}</td><td>${r.tamir}</td><td>${garantiText(r.tamir,r.tarih)}</td><td>${r.fiyat.toFixed(2)}</td><td>${new Date(r.tarih).toLocaleDateString('tr-TR')}</td>
      <td>
        <button data-i="${i}" class="editBtn">DÃ¼zenle</button>
        <button data-i="${i}" class="delBtn">Sil</button>
      </td>`;
    recordsTbody.appendChild(tr);
  });
  attachRecordActions();
}

function renderExpired(){
  expiredTbody.innerHTML='';
  records.forEach(r=>{
    if(garantiText(r.tamir,r.tarih) === 'Bitti'){
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${r.sn}</td><td>${r.usta}</td><td>${r.tamir}</td><td>Bitti</td>`;
      expiredTbody.appendChild(tr);
    }
  });
}

function renderMonthly(){
  const filter = document.getElementById('timeFilter').value;
  monthlyTbody.innerHTML='';
  const now = new Date();
  records.forEach(r=>{
    const t = new Date(r.tarih + 'T00:00:00');
    const days = (now - t)/(1000*60*60*24);
    if(filter === 'weekly' && days > 7) return;
    if(filter === 'monthly' && days > 30) return;
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${r.sn}</td><td>${r.usta}</td><td>${r.tamir}</td><td>${new Date(r.tarih).toLocaleDateString('tr-TR')}</td><td>${r.fiyat.toFixed(2)}</td>`;
    monthlyTbody.appendChild(tr);
  });
}

function renderStats(){
  const totals = {LED:0,Besleme:0,Panel:0,Yazilim:0,Anakart:0,TL:0};
  records.forEach(r=>{
    if(r.tamir.includes('LED')) totals.LED++;
    else if(r.tamir.includes('Besleme')) totals.Besleme++;
    else if(r.tamir.includes('Panel')) totals.Panel++;
    else if(r.tamir.includes('YazÄ±lÄ±m')||r.tamir.includes('Yazilim')) totals.Yazilim++;
    else if(r.tamir.includes('Anakart')) totals.Anakart++;
    totals.TL += parseFloat(r.fiyat) || 0;
  });
  document.getElementById('totalLED').textContent = totals.LED;
  document.getElementById('totalBesleme').textContent = totals.Besleme;
  document.getElementById('totalPanel').textContent = totals.Panel;
  document.getElementById('totalYazilim').textContent = totals.Yazilim;
  document.getElementById('totalAnakart').textContent = totals.Anakart;
  document.getElementById('totalTL').textContent = totals.TL.toFixed(2);
  document.getElementById('count').textContent = records.length;
  document.getElementById('sumTL').textContent = totals.TL.toFixed(2);
}

function renderAll(){ renderRecords(); renderExpired(); renderMonthly(); renderStats(); }

function attachRecordActions(){
  document.querySelectorAll('.editBtn').forEach(b=>b.addEventListener('click', e=>{
    const i = parseInt(b.getAttribute('data-i'));
    startEdit(i);
  }));
  document.querySelectorAll('.delBtn').forEach(b=>b.addEventListener('click', e=>{
    const i = parseInt(b.getAttribute('data-i'));
    if(confirm('KaydÄ± silmek istiyor musunuz?')){ records.splice(i,1); persist(); renderAll(); }
  }));
}

function startEdit(i){
  const r = records[i];
  document.getElementById('sn').value = r.sn;
  document.getElementById('usta').value = r.usta;
  if(['YazÄ±lÄ±m','Besleme','LED','Panel','Anakart'].includes(r.tamir)){
    document.getElementById('tamir').value = r.tamir;
    otherWrap.style.display = 'none';
  } else {
    document.getElementById('tamir').value = 'Diger';
    otherWrap.style.display = 'block';
    otherEl.value = r.tamir;
  }
  document.getElementById('fiyat').value = r.fiyat;
  document.getElementById('tarih').value = r.tarih;
  editIndex = i; updateBtn.style.display='inline-block'; saveBtn.style.display='none'; showPanel('new');
}

// Filters
['search','filterUsta','filterType','timeFilter'].forEach(id=>{
  const el = document.getElementById(id);
  if(!el) return;
  el.addEventListener('input', ()=>{ renderAll(); });
});

document.getElementById('timeFilter').addEventListener('change', renderMonthly);

// Export CSV & Clear All
document.getElementById('exportCsv').addEventListener('click', ()=>{
  if(!records.length){ alert('KayÄ±t yok'); return; }
  const rows = [['SN','Usta','Tamir','Fiyat','Tarih']];
  records.forEach(r=> rows.push([r.sn,r.usta,r.tamir,r.fiyat,r.tarih]));
  const csv = rows.map(r=> r.map(c=> '"'+String(c).replace(/"/g,'""')+'"').join(',')).join('\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'tv_records.csv'; a.click(); URL.revokeObjectURL(url);
});

document.getElementById('clearAll').addEventListener('click', ()=>{
  if(confirm('TÃ¼m kayÄ±tlarÄ± silmek istediÄŸinize emin misiniz?')){ records = []; persist(); renderAll(); }
});

// Theme
const themeSelect = document.getElementById('themeSelect');
themeSelect.addEventListener('change', ()=>{
  if(themeSelect.value === 'light') document.body.style.background = '#f3f6fb', document.body.style.color='#0e1a2f';
  else document.body.style.background = 'linear-gradient(180deg,#071226,#07182a)';
});

// Init
(function(){
  if(records.length && !records[0].tarih) {
    // migrate older format if needed
    records = records.map(r=>({...r,tarih: r.tarih ? new Date(r.tarih).toISOString().slice(0,10) : new Date().toISOString().slice(0,10)}));
    persist();
  }
  renderAll();
  showPanel('new');
})();

</script>
</body>
</html>
