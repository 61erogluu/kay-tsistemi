<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Eroğlu Servis Yönetim</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="module">
  // --- Firebase Import ---
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCkS2QqyYNAWvIGYHmXtg0tFwAUtxYnYhE",
    authDomain: "ef-8914e.firebaseapp.com",
    projectId: "ef-8914e",
    storageBucket: "ef-8914e.appspot.com",
    messagingSenderId: "131514808744",
    appId: "1:131514808744:web:7b45d2f5fbedff9abf859d",
    measurementId: "G-3XWC0SF1PY",
    databaseURL: "https://ef-8914e-default-rtdb.firebaseio.com/"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  window.firebaseDB = db;
</script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;400;600;700;900&display=swap" rel="stylesheet">
<style>
:root{
  --primary:#FF5733; --bg:#0A0A0A; --card:#1C1C1C; --text:#F0F0F0;
}
*{box-sizing:border-box;}
body{margin:0;padding:0;font-family:'Poppins',sans-serif;background:var(--bg);color:var(--text);}
.header{height:60px;background:var(--card);display:flex;align-items:center;padding:0 20px;position:fixed;width:100%;top:0;z-index:1000;box-shadow:0 5px 20px rgba(0,0,0,0.8);}
.header .brand{font-weight:900;color:var(--primary);font-size:1.6rem;letter-spacing:1px;}
.main{margin-top:70px;padding:15px;}
.card{background:var(--card);padding:20px;border-radius:10px;margin-bottom:20px;box-shadow:0 5px 15px rgba(0,0,0,0.7);transition:0.3s;}
.card:hover{box-shadow:0 10px 30px rgba(0,0,0,0.9);}
.btn{padding:10px 15px;border:none;border-radius:5px;background:var(--primary);color:#fff;cursor:pointer;transition:0.2s;}
.btn:hover{opacity:0.8;}
.btn-secondary{background:#888;}
.input,textarea{padding:10px;border-radius:5px;border:1px solid #333;background:var(--bg);color:var(--text);width:100%;margin-bottom:10px;transition:0.2s;}
.input:focus,textarea:focus{border-color:var(--primary);outline:none;}
.hidden{display:none;}
.table{width:100%;border-collapse:collapse;margin-top:10px;}
.table th,.table td{padding:10px;border-bottom:1px solid #333;text-align:left;}
.table th{color:var(--primary);}
.badge{padding:3px 6px;border-radius:5px;color:#fff;font-size:0.75rem;}
.badge.active{background:#28a745;}
.badge.passive{background:#dc3545;}
@media(max-width:600px){
  .header .brand{font-size:1.2rem;}
  .btn,input,textarea{font-size:0.9rem;}
}
</style>
</head>
<body>

<div class="header">
  <div class="brand">EROĞLU SERVİS</div>
</div>

<main class="main">

<div class="card" id="addRecordCard">
  <h2>Yeni Servis Girişi</h2>
  <input class="input" id="inpCode" placeholder="TV Kod/Seri">
  <input class="input" id="inpModel" placeholder="TV Modeli">
  <input class="input" id="inpProcess" placeholder="Yapılan İşlem">
  <input class="input" type="date" id="inpWarrantyDate">
  <textarea class="input" id="inpNotes" placeholder="Notlar"></textarea>
  <button class="btn" id="addRecordBtn">Kaydı Ekle</button>
</div>

<div class="card" id="recordsCard">
  <h2>Servis Kayıtları</h2>
  <table class="table" id="recordsTable">
    <thead>
      <tr>
        <th>Kod</th><th>Model</th><th>İşlem</th><th>Tarih</th><th>Garanti</th><th>İşlem</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div class="card" id="adminPanelCard">
  <h2>Admin Paneli</h2>
  <input class="input" type="password" id="adminInput" placeholder="Admin Şifre">
  <button class="btn" id="adminLoginBtn">Giriş</button>
  <div id="adminTools" class="hidden">
    <hr>
    <label>Renk Seçin:</label>
    <input class="input" type="color" id="colorPrimary" value="#FF5733">
    <button class="btn" id="saveColorBtn">Renk Kaydet</button>
  </div>
</div>

</main>

<script type="module">
import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";
const db = window.firebaseDB;
let isAdmin=false;

const recordsTableBody=document.querySelector('#recordsTable tbody');
const addBtn=document.getElementById('addRecordBtn');
const adminInput=document.getElementById('adminInput');
const adminLoginBtn=document.getElementById('adminLoginBtn');
const colorPrimary=document.getElementById('colorPrimary');
const saveColorBtn=document.getElementById('saveColorBtn');
const adminTools=document.getElementById('adminTools');

function formatDate(d){return new Date(d).toLocaleDateString('tr-TR');}

function renderRecords(records){
  recordsTableBody.innerHTML='';
  records.forEach(r=>{
    const warrantyEnd=new Date(r.warrantyDate);
    const isWarrantyActive=warrantyEnd>new Date();
    const badgeClass=isWarrantyActive?'active':'passive';
    const badgeText=isWarrantyActive?'SÜRÜYOR':'BİTTİ';
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${r.code}</td><td>${r.model}</td><td>${r.process}</td>
      <td>${formatDate(r.created)}</td>
      <td><span class="badge ${badgeClass}">${formatDate(r.warrantyDate)} - ${badgeText}</span></td>
      <td><button class="btn btn-secondary" onclick="deleteRecord('${r.key}')">Sil</button></td>`;
    recordsTableBody.appendChild(tr);
  });
}

const recordsRef=ref(db,'records');
onValue(recordsRef,snapshot=>{
  const data=snapshot.val()||{};
  const arr=Object.keys(data).map(k=>({...data[k],key:k}));
  renderRecords(arr);
});

addBtn.addEventListener('click',()=>{
  const code=document.getElementById('inpCode').value.trim();
  const model=document.getElementById('inpModel').value.trim();
  const process=document.getElementById('inpProcess').value.trim();
  const notes=document.getElementById('inpNotes').value.trim();
  let warrantyDate=document.getElementById('inpWarrantyDate').value;
  if(!warrantyDate){const d=new Date();d.setFullYear(d.getFullYear()+1);warrantyDate=d.toISOString();}
  const created=new Date().toISOString();
  if(!code||!model||!process){alert('Kod, Model ve İşlem gerekli!');return;}
  const newRef=push(recordsRef);
  set(newRef,{code,model,process,notes,warrantyDate,created});
  document.getElementById('inpCode').value=''; document.getElementById('inpModel').value='';
  document.getElementById('inpProcess').value=''; document.getElementById('inpNotes').value=''; document.getElementById('inpWarrantyDate').value='';
});

window.deleteRecord=(key)=>{if(confirm('Silmek istiyor musunuz?')) remove(ref(db,'records/'+key));}

adminLoginBtn.addEventListener('click',()=>{
  if(adminInput.value==='6161'){isAdmin=true;alert('Admin Girişi Başarılı!');adminTools.classList.remove('hidden');} 
  else alert('Hatalı şifre!');
});

saveColorBtn.addEventListener('click',()=>{
  if(!isAdmin){alert('Önce admin girişi yap!');return;}
  const c=colorPrimary.value;
  document.documentElement.style.setProperty('--primary',c);
  alert('Renk değiştirildi!');
});
</script>

</body>
</html>
